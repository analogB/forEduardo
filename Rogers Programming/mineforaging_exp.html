<!doctype html>
<html>
    <head>
        <title>research study</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="jspsych-5.0.3br3/jspsych.js"></script>
        <script src="jspsych-5.0.3br3/plugins/jspsych-text.js"></script>
        <script src="jspsych-5.0.3br3/plugins/jspsych-mine-text.js"></script>
        <script src="jspsych-5.0.3br3/plugins/jspsych-forage01.js"></script>
        <script src="https://www.gstatic.com/charts/loader.js"></script>
        <link  href="jspsych-5.0.3br3/css/jspsych.css" rel="stylesheet" type="text/css"></link>

    </head>
    <body> </body>
    <script>


  /////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* DEFINE DATA FILE SAVE NAME */
  var expName = "forage01--"

  /////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* DEFINE STIMULI AND INSTRUCTION CONTENT */

  var stimFilename = "textStims.txt";
  var transitionDelay = 100;
  var indention =       25;
  var turkSubmitCode =  42*42;
  var poor = [80,20,0];
  var rich = [50,45,5];

  var studyTopic =
                            "conversation and thinking";
  var studyPurpose =
                            "to better understand how people make predictions and become confident";
  var taskDescription =
                            "make predictions about uncertain patterns";
  var debriefDescription =
                            "This study is investigating how people's judgements, predictions, and choices are influenced by correspondences in structure and hidden information. The investigators will compare participant responses to statistical traits of the stimuli to better understand the role of chance and probability in human judgements."; //Full sentence

  ////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* DEFINE CONTACT INFO */
  function indenter(nSpaces){ var out = [];
                              for (i = 0; i < nSpaces; i++){
                                  out += "&nbsp;"};
                              return out};

  var indent = indenter(indention);

  var contactLandy =    indent + "<i>Dr. David Landy, Assistant Professor<br>"+
                        indent + "Department of Psychological and Brain Sciences, Indiana University<br>"+
                        indent + "1101 East 10th Street, Bloomington, IN 47405<br>"+
                        indent + "(812) 336-4449 <br>"+
                        indent + "dlandy at indiana dot edu</i></p>";

  var contactGoldstone = indent + "<i>Dr. Rob Goldstone <br>"+
                        indent + "Department of Psychological and Brain Sciences, Indiana University<br>"+
                        indent + "1101 East 10th Street, Bloomington, IN 47405<br>"+
                        indent + "(812) 855-4853 <br>"+
                        indent + "rgoldsto at indiana dot edu</i></p>";

  var contactInvestigator = contactLandy;

  var investigatorName = "Dr. David Landy";
  var departmentName = "Department of Psychological and Brain Sciences";
  var institutionName = "Indiana University";

 ////////////////////////////////////////////////////////////////////////////////////////////////////////
 /* DEFINE NAVIGATION PROMPTS */
  var keyAdvance = "<p><i>Press the spacebar to advance.</i></p>";
  var buttonAdvance = "Make your response and click the <i>SUBMIT ANSWERS</i> button to continue.";
  var noBrowserControl = "Note: Browser controls will not work during this task. Clicking BACKWARD or REFRESH in the browser controls will <u>reset the entire task</u>.";

 ////////////////////////////////////////////////////////////////////////////////////////////////////////
 /* DEFINE INSTRUCTIONS */

 var invitation =
              ["You are invited to participate in a research study on "+studyTopic+", conducted by "+ investigatorName +" in the "+ departmentName + " at "+ institutionName +". Please read the following form and ask any questions before agreeing to be in the study. <br><br><br>"+
              noBrowserControl + "<br><br>" +
              keyAdvance
              ];

  var consentForm = //#for SONA Online
              ['<div id="consent">'+
               '<p class="lead_right">IRB Study # 1511805816</p>'+
                  '<b>INDIANA UNIVERSITY STUDY INFORMATION SHEET</b><br>'+
                  '<b>Prediction During Communication</b><br><br>'+

                  'You are invited to participate in a research study on conversation, conducted by Dr. David Landy in the Department of Psychological and Brain Sciences. You have been recruited to participate through the Psychological and Brain Sciences subject pool on SONA. Please read this form and ask any questions before agreeing to be in the study. <br><br>'+

                  '<b>STUDY PURPOSE: </b><br>'+
                  'The purpose of this study is to better understand how people make predictions during conversations.<br><br>'+

                  '<b>NUMBER OF PEOPLE TAKING PART IN THE STUDY:</b><br>'+
                  'If you agree to participate, you will be one of approximately 6000 subjects who will be participating in this research.<br><br>'+

                  '<b>PROCEDURES FOR THE STUDY:</b><br>'+
                  'If you agree to be in the study, you will be presented with several straightforward tasks to complete, including responding with key strokes to stimuli (e.g., images, videos, words) displayed on a computer monitor or completing a survey about your opinions. The entire session will take no longer than 120 minutes.  The study may occur over one or two sessions.<br><br>'+

                  '<b>RISKS OF TAKING PART IN THE STUDY:</b><br>'+
                  'Participation in this study involves a potential risk of loss of confidentiality. Professors are only told the total number of "credits" received by a student for participating in studies, so professors are not told whether or not a student participated in their particular study.<br><br>'+

                  '<b>BENEFITS OF TAKING PART IN THE STUDY:</b><br>'+
                  'An understanding of how people make predictions during conversation can help us understand how to improve communication. You benefit from this experience because you learn something about how an experiment is designed and conducted and what issues are of interest to cognitive scientists <br><br>'+

                  '<b>ALTERNATIVES TO TAKING PART IN THE STUDY:</b><br>'+
                  'An alternative to participating in the study is to choose not to participate. If you choose not to participate, you have an alternative way to earn credit; please talk to your instructor<br><br>'+

                  '<b>PAYMENT:</b><br>'+
                  'For participating in this study, you will receive course credit, equivalent to 0.5 credit for each half-hour of participation, up to maximum of 2 credits. <br><br>'+

                  '<b>CONTACTS FOR QUESTIONS OR PROBLEMS:</b><br>'+
                  'For questions about the study, contact the researcher Dr. David Landy at (812) 336-4449.  <br><br>'+

                  'For questions about your rights as a research participant or to discuss problems, complaints or concerns about a research study, or to obtain information, or offer input, contact the IU Human Subjects Office: (812) 856-4242 or irb@iu.edu <br><br>'+

                  '<b>VOLUNTARY NATURE OF STUDY:</b><br>'+
                  'Taking part in this study is voluntary.  You may choose not to take part or may leave the study at any time.  Leaving the study will not result in any penalty or loss of benefits to which you are entitled and you will be compensated for your time up to that point.  Your decision whether or not to participate in this study will not affect your current or future relations with the investigator(s).<br><br>'+

                  'Please print a copy of this information sheet if you would like it for your records.<br><br>'+

                  'Form date: November 19, 2015<br><br>'+

                  keyAdvance +
                  '</div>']

  var consentVoluntary =
               ["<p><b>VOLUNTARY NATURE OF STUDY</b></p>" +
                "<p>Taking part in this study is voluntary. You may choose not to take part or may leave the study at any time. You may withdraw by closing your web browser.</p>" +
                keyAdvance];

  var debrief =
               ["<b>THANK YOU</b><br>" +
                "Thank you for participating in our study. " + debriefDescription + " If you have questions concerning this study you may contact the lead investigator:<br><br>" +
                contactInvestigator +
                "<p><i>Press spacebar to advance to finalize your responses and receive your Mechanical Turk HIT code.</i></p>"];
                // "<p><i>Press any key to receive the HIT code.</i></p>"];

  var debriefSONA =
              ["<b>THANK YOU</b><br>" +
               "Thank you for participating in our study. " + debriefDescription + " If you have questions concerning this study you may contact the lead investigator:<br><br>" +
               contactInvestigator +
               "<p><i><b>PRESS SPACEBAR TO FINALIZE YOUR RESPONSES.</b></i></p>"];
               // "<p><i>Press any key to receive the HIT code.</i></p>"];

  var secretCode =
               ["Please enter the code: <b>" + turkSubmitCode + "</b> in Mechanical Turk to complete this HIT." +
                "<p><i>Press spacebar to finalize this task.</i></p>"];

  var finalText =
               ["<p><i>Thank you for participating in our study! Your responses have been recorded and you will receive credit within a couple of days. You may now close your browser window.</i></p>"];

  var repeatSubject =
               ["<b>Qualification Error</b><br>" +
                "For statistical purposes, tasks for this study require unique participants. It appears that you have already participated in a task for this study. If you have questions concerning this study you may contact the lead investigator:<br>" +
                contactInvestigator +
                "<p><i>Please enter \"Repeat007\" for the HIT code.</i></p>"];


  /////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* DEFINE TEST STIMULI */
  // note. all images must be placed in img/ folder named like: gold.png

  var mine1Composition = [
    ['grass',0],
    ['stone',0],
    ['dirt',poor[0]],
    ['sand',0],
    ['gravel',0],
    ['gold',poor[1]],
    ['iron',0],
    ['coal',0],
    ['diamond',poor[2]],
    ['redstone',0],
    ['lapislazuli',0],
    ['emerald',0]
  ];

  var mine2Composition = [
    ['grass',0],
    ['stone',0],
    ['dirt', rich[0]],
    ['sand',0],
    ['gravel',0],
    ['gold',rich[1]],
    ['iron',0],
    ['coal',0],
    ['diamond',rich[2]],
    ['redstone',0],
    ['lapislazuli',0],
    ['emerald',0]
  ];

  function resource_prob_cumulator(composition){
    var tot = 0
    for (i=0;i<composition.length;i++){
      var current = composition[i][1];
      composition[i][2] = composition[i][1]+tot;
      tot += current;
    };
    for (i=0;i<composition.length;i++){
      composition[i][2]=composition[i][2]/tot;
    };
  };

  resource_prob_cumulator(mine1Composition)
  resource_prob_cumulator(mine2Composition)

  function rff (composition, fraction){
    for (i=0;i<composition.length;i++){
      if (fraction<composition[i][2]){
        return composition[i][0];
      };
    };
  };

  var nBlocks = 10;
  var nTrials = 52; //52
  var proportion1 = 0.5
  var test_turns = [];
  for(i=0;i<nTrials;i++){
    test_turns.push({turn:i});
  };

  function resource_lister(comp,n){
    var resource_list = [];
    for(j=0;j<n;j++){
      rand = Math.random();
      resource_list.push(rff(comp,rand));
      };
    return resource_list;
  };

  function random_list(mine1,mine2,trials,p1){
    if (Math.random() <= p1){
      test_mine = mine1;
    } else {
      test_mine = mine2;
    }
    test_resources = resource_lister(test_mine,trials);
    //console.log(test_resources)
    return test_resources;
  };


function IB_numseq(n,L1,L2){ //This function makes number sequences with interleaved or blocked L1/L2
  var out = [];
  if (!L1 && !L2){ //L1 blocked, L2 blocked
    for(i=0;i<4*n;i++){
      out.push(Math.floor(i/n)); //000111222333
    };
  } else if (!L1 && L2 ){ //L1 blocked, L2 interleaved
    for(i=0;i<4*n;i++){
      out.push(((Math.floor(i))%2)+(2*Math.floor(i/2/n))); //0101010123232323
    };
  } else if (L1 && !L2 ){ //L1 interleaved, L1 blocked
    for(i=0;i<4*n;i++){
      out.push(2*((Math.floor(i))%2)+(Math.floor(i/2/n))); //020202131313
    };
  } else if (L1 && L2){ //L1 interleaved, L2 interleaved
    for(i=0;i<4*n;i++){
      out.push(Math.floor(((i%4)+1)/2)+Math.floor((i%4)%2)); //021302130213
    };
  };
  return out
};

function IB_seq(n,L1,L2){ //This function calls the interlever/blocker and randomly assigns the category condition
  var out=[];
  var input=IB_numseq(n,L1,L2);
  var A=Math.round(Math.random());
  var B=Math.round(Math.random());
  var assign=[A,(A+1)%2,B+2,((B+1)%2)+2]; //4 possibilities: 0123, 1023, 0132, 1032 @random
  for(i=0;i<input.length;i++){
    out.push(assign[input[i]]);
  };
  return out
};

function IB_paths(n,L1,L2){ //This funciton assigns directory names to sequence numerals
  var out=[];
  var input=IB_seq(n,L1,L2);
  var paths=[{0:'A1',1:'A2',2:'B1',3:'B2'}];
  for(i=0;i<input.length;i++){
    out.push([input[i],'images/'+paths[0][input[i]]+'/']);
  }
  return out
};

function rand_seq(n) {
  var curr=n, temp, rand;
  var out=Array.apply(0, Array(n)).map(function(val,i) { return i; })
  while (0!==curr) {
    rand=Math.floor(Math.random()*curr);
    curr-=1;
    temp=out[curr];
    out[curr] = out[rand];
    out[rand] = temp;
  }
  return out;
};

function IB_images(n,L1,L2){ //This fuction randomizes the images according to the paths
  var out=[];
  var input=IB_paths(n,L1,L2);
  var dirs=['/images/A1/','/images/A2/','/images/B1/','/images/B2/'];
  var files = [[],[],[],[]];
  for(j=0;j<4;j++){
    files[j] = rand_seq(n); //please manually check to ensure sufficient images in each directory
  }
  var count=[0,0,0,0];
  for(i=0;i<input.length;i++){
      out.push([input[i][0],input[i][1]+files[input[i][0]][count[input[i][0]]]+'.png']);
      count[input[i][0]]+=1
  }
  return out //correct reponse at out[i][0] where A1:0, A2:1, B1:2, B2:3    //pathnames at out[i][1]
};


  resource_values = [{nothing:  0,
                      dirt:     0,
                      sand:     0,
                      gravel:   0,
                      stone:    0,
                      coal:     0,
                      iron:     1,
                      gold:     1000,
                      diamond:  100000,
                      emerald:  0,
                      lapislazuli:0,
                      redstone: 0}]

  var mine1Description =
                          'There are two kinds of territories you might receive. It is impossible to know which territory you have until you start to explore it. The first kind is a <b>POOR</b> territory because because it contains fewer valuable minerals. Poor territories contain only dirt and gold. There are no diamonds in Poor territories. The typical composition of Poor territories is shown below:'
  var mine2Description =
                          'There is another kind of territory called a <b>RICH</b> territory because it contains more minerals that are valuable. Rich territories contain dirt, gold, and diamonds. The typical composition of Rich territories is shown below.'

  var exploreButton = "Explore Random New Mineshaft"

  var extractButton = "Extract More from the Best Mineshaft"

  var instr1 =
               ["<b>INSTRUCTIONS</b><br>"+
                "Welcome to MINE MANAGER, a game where you must make decisions with uncertain information. The goal of this game is simple: extract minerals to earn the highest total value from the territory you are assigned. You will have "+nTrials+" turns to make exploration and extraction decisions. There are three kinds of minerals worth different values: <br>" +
                "<table style='border-spacing:40px'>"+
                  "<tr><td><figcaption caption-side=top align=center> <b>dirt ($"+resource_values[0].dirt/1000+"K)</b></figcaption><img display=inline-block width='100px' src='img/dirt.png'></img></td>"+
                  "<td><figcaption caption-side=top align=center> <b>gold ($"+resource_values[0].gold/1000+"K)</b></figcaption><img display=inline-block width='100px' src='img/gold.png'></img></td>"+
                  "<td><figcaption caption-side=top align=center> <b>diamond ($"+resource_values[0].diamond/1000+"K)</b></figcaption><img display=inline-block width='100px' src='img/diamond.png'></img></td></tr></table>"+
                  "<br><b>Diamonds are much more valuable than gold.</b> Extracting just one turn of diamond is worth more than extracting gold every turn in a game. But not all territories have diamonds in them.<br>"+
                keyAdvance];
  var instr2 =
                ["<b>INSTRUCTIONS</b><br>"];
  var instr3 =
                ["<b>INSTRUCTIONS</b><br>"+
                "Each game you will be assigned a TERRITORY, but you will not know what type of territory it is. It might be a RICH or a POOR territory with equal chances. When you begin, there will not be any mineshafts in your territory, so you will need to make a new mineshaft. Each turn, you may either "+ exploreButton +" or "+ extractButton +". As you explore new mineshafts you should become more confident whether your current territory is RICH or POOR. <br><br>You may continue to indefinitely extract minerals from the best mineshaft until you run out of turns. For example, if you get lucky and strike diamonds in your first mineshaft, you would not need to explore any more mineshafts for the remaining turns and you might choose to 'Extract More from the Best Mineshaft' for the remaining turns."+
                keyAdvance];
  var instr4 =
                ["<b>INSTRUCTIONS</b><br>"+
                "You will play the game "+ nBlocks +" separate times. For each game you will be randomly assigned a new territory, and you will not know which kind of territory it is. Your game scores will be evaluated separately, not combined. So you should try to do your best on each game based on the kind of territory you think you have. Your performance in each game will be evaluated against other participants with the same kind of territory."+
                keyAdvance];
  var instr5 =
                ["<b>INSTRUCTIONS</b><br>"+
                "You may continue to the next game when you are ready. You will play the game "+ nBlocks +" separate times in total. Each gime you will receive a random new RICH or POOR territory with equal chances."];


  //////////////////////////////////////////////////////////////////////////////////////////////////////
  /* DEFINE SAVE METHOD */
  function saveData(filename, filedata){
                        $.ajax({
                              type:'post',
                              cache: false,
                              url: 'save_data.php', // this is the path to the above PHP script
                              data: {filename: filename, filedata: filedata}
                        });
  };

  // function saveParticipants(filename,filedata){
  //                       $.ajax({
  //                             type:'post',
  //                             cache: false,
  //                             url: 'save_participants.php', // this is the path to the above PHP script
  //                             data: {filename: filename, filedata: filedata}
  //                       });
  // };
  //var turkInfo = jsPsych.turk.turkInfo();
  //var mTurkID =  turkInfo.workerId;
  //var mTurkID = 'tester01'

  var getUrlParameter = function getUrlParameter(sParam) {
      var sPageURL = decodeURIComponent(window.location.search.substring(1)),
          sURLVariables = sPageURL.split('&'),
          sParameterName,
          i;

      for (i = 0; i < sURLVariables.length; i++) {
          sParameterName = sURLVariables[i].split('=');

          if (sParameterName[0] === sParam) {
              return sParameterName[1] === undefined ? true : sParameterName[1];
          }
      }
  };

  var SONAID = getUrlParameter('sonaid');


  ////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* DEFINE JSPSYCH BLOCKS */
  var invitation_block = {
            type:   "text",
            text:    invitation,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  var consentForm_block = {
            type:   "text",
            text:   consentForm,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  var consentVoluntary_block = {
            type:   "text",
            text:   consentVoluntary,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  var instructions1_block = {
            type:   "text",
            text:   instr1,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  var instructions2_block = {
            type:   "mine-text",
            composition: [mine1Composition, mine2Composition],
            descript: [mine1Description, mine2Description],
            preamble:   instr2,
            randomizeMine: true,
            mineBlocksHigh: 20,
            mineBlocksWide: 40,
            mineScale: 0.75,
            legend: true,
            cont_text: keyAdvance,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  var instructions3_block = {
            type:   "text",
            text:   instr3,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  var instructions4_block = {
            type:   "text",
            text:   instr4,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  // var instructions5_block = {
  //           type:   "text",
  //           text:   instr5,
  //           cont_key: [13,32],
  //           timing_post_trial: transitionDelay
  //       };

  var instructions5_block = {
            type:   "mine-text",
            composition: [mine1Composition, mine2Composition],
            descript: [mine1Description, mine2Description],
            preamble:   instr5,
            randomizeMine: true,
            mineBlocksHigh: 20,
            mineBlocksWide: 40,
            mineScale: 0.75,
            legend: true,
            cont_text: keyAdvance,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };


  var test1_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test2_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };


  var test3_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test4_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test5_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test6_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test7_block = {
  type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test8_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test9_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var test10_block = {
            type: 'forage01',
            choices: ['<b>'+ exploreButton + '</b>', '<b>'+ extractButton +'</b>'],
            resources: random_list(mine1Composition,mine2Composition,nTrials,proportion1),
            values: resource_values,
            timeline: test_turns,
            nTrials: nTrials,
            timing_post_trial: transitionDelay,
            randomize_order: false,
            on_finish: function(data){}
        };

  var debrief_block = {
            type:   "text",
            text:   debriefSONA,
            cont_key: [13,32],
            timing_post_trial: transitionDelay,
            on_finish:  function(data){
                              var time_foo = new Date();
                              var experiment_time = time_foo.getTime();
                              //jsPsych.data.addProperties({turkID: mTurkID});
                              jsPsych.data.addProperties({sonaID: SONAID});
                              jsPsych.data.addProperties({ExpEndTime: experiment_time});
                              //saveData(expName + '_ID' + mTurkID + '_T' + experiment_time + '.csv', jsPsych.data.dataAsCSV());
                              saveData(expName + '_ID' + SONAID + '_T' + experiment_time + '.csv', jsPsych.data.dataAsCSV());
                              // if (mTurkID != "" && uniqueSubject == true){
                              //     participantList.push(mTurkID);
                              //     saveParticipants(participantFileName, participantList.join(","))};
                        }
        };

  var final_block = {
            type:   "text",
            text:   finalText,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };

  var repeatSubject_block = {
            type:   "text",
            text:    repeatSubject,
            cont_key: [13,32],
            timing_post_trial: transitionDelay
        };


  ////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* CHECK REPEAT SUBJECT*/

  // var mTurkIDFake = '01ABE'

  // var participantFileName = "participantList.txt";
  // var participantList = $.ajax({
  //                 url: participantFileName,
  //                 async: false
  //              }).responseText;
  // participantList = participantList.split(",");
  //
  // function arrayContains(needle, arrhaystack){
  //           return (arrhaystack.indexOf(needle) > -1);
  // };
  //
  // var uniqueSubject = !arrayContains(mTurkID,participantList);
 var uniqueSubject = true;


  ////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* DEFINE EXPERIMENT TIMELINE */
  var timeline = [];
        timeline.push(invitation_block);
        if (uniqueSubject) {
            timeline.push(consentForm_block);
            timeline.push(consentVoluntary_block);
            timeline.push(instructions1_block);
            timeline.push(instructions2_block);
            timeline.push(instructions3_block);
            timeline.push(instructions4_block);

            timeline.push(instructions5_block);
            timeline.push(test1_block);
            timeline.push(instructions5_block);
            timeline.push(test2_block);
            timeline.push(instructions5_block);
            timeline.push(test3_block);
            timeline.push(instructions5_block);
            timeline.push(test4_block);
            timeline.push(instructions5_block);
            timeline.push(test5_block);
            timeline.push(instructions5_block);
            timeline.push(test6_block);
            timeline.push(instructions5_block);
            timeline.push(test7_block);
            timeline.push(instructions5_block);
            timeline.push(test8_block);
            timeline.push(instructions5_block);
            timeline.push(test9_block);
            timeline.push(instructions5_block);
            timeline.push(test10_block);

            timeline.push(debrief_block);
            timeline.push(final_block);
        } else {
            timeline.push(repeatSubject_block);
        };

  ////////////////////////////////////////////////////////////////////////////////////////////////////////
  /* START EXPERIMENT*/
  jsPsych.init({
        timeline: timeline,
        // on_finish: function() {
        //       jsPsych.data.displayData();
            // }
        });

    </script>
</html>
